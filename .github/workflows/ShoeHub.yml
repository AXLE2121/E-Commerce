name: ShoeHub

# Trigger the workflow on pushes to the main or develop branches
on:
  push:
    branches:
      - main
      - develop

# --- JOBS START HERE ---
jobs:
  # 1. CHECK JOB: Runs first to perform basic validation (e.g., check for index.html)
  check_html:
    name: Check Static Files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      
      # Optional: Add a step here to run an HTML linter or specific validation.
      # For now, we'll just check for a critical file.
      - name: Verify Index File Exists
        # This will fail the job if index.html is missing from the root.
        run: |
          if [ ! -f index.html ]; then
            echo "::error file=index.html::index.html not found in the repository root. Deployment will fail."
            exit 1
          fi

  # 2. PREPARE JOB: Runs only if the CHECK job succeeds
  prepare_files:
    name: Prepare Deployment Artifact
    # This job requires the 'check_html' job to pass
    needs: check_html
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # Upload the static files (from the root directory '.') to share them with the deploy job
      - name: Upload Deployment Artifact
        uses: actions/upload-artifact@v4
        with:
          name: deployment-package
          # We upload the root directory contents, as this is the "build" step for plain HTML
          path: . 

  # 3. DEPLOY JOB: Runs only if the PREPARE job succeeds
  deploy:
    name: Deploy to Netlify
    # This job requires the 'prepare_files' job to pass
    needs: prepare_files
    runs-on: ubuntu-latest
    steps:
      - name: Download Build Artifact
        # Downloads the static files prepared in the 'prepare_files' job
        uses: actions/download-artifact@v4
        with:
          name: deployment-package
          # The path where the files will be downloaded (the root for deployment)
          path: deploy_root 

      # The Netlify deployment action
      - name: Netlify Deploy
        uses: nwtgck/actions-netlify@v2.0
        with:
          # Required inputs for Netlify
          # The Netlify action deploys the contents of the 'deploy_root' folder
          publish-dir: 'deploy_root' 
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
          # Optional: Specify the branch to deploy to production
          production-branch: main